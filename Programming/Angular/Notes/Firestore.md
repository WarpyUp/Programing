
### **Cloud Firestore: Головні Концепції та Важливі Нюанси**

Cloud Firestore — це **NoSQL-база даних**, розроблена Google для мобільних, веб- та серверних додатків. Вона відома своєю гнучкістю, масштабованістю та потужними можливостями синхронізації в реальному часі.

Ось найважливіші речі, які тобі потрібно знати:

#### 1. Структура Даних: Колекції та Документи (Collections and Documents)

У Firestore дані організовані як ієрархія **колекцій** та **документів**. Це як папки та файли на комп'ютері, але з деякими особливостями:

- **Документ (Document):** Це базова одиниця зберігання даних. Документ — це, по суті, **набір пар ключ-значення**, схожий на JSON-об'єкт.
    
    - Приклад: Твоя нотатка — це один документ.
    - Кожен документ має **унікальний ID**. Ти можеш дозволити Firestore згенерувати його автоматично (як ти зробив, це кращий спосіб для більшості випадків), або вказати свій ID.
    - Документи **не мають жорсткої схеми**. Ти можеш додати різні поля до різних документів в одній колекції. Однак, для зручності розробки та уникнення помилок, зазвичай варто дотримуватися певної, хоча й гнучкої, структури.
- **Колекція (Collection):** Це контейнер для документів.
    
    - Приклад: Твоя колекція `notes` містить усі твої нотатки-документи.
    - **Колекції містять лише документи.** Ти не можеш зберігати "прості" дані безпосередньо в колекції; вони завжди повинні бути частиною документа.
    - **Немає обмежень на кількість колекцій** у базі даних або на кількість документів у колекції.
- **Субколекції (Subcollections):** Документи можуть містити **субколекції**. Це дозволяє створювати глибокі, вкладені ієрархії даних.
    
    - Приклад: Уяви, що в тебе є нотатка (документ `notes/note_id_1`), і ти хочеш додавати до неї коментарі. Ти можеш створити субколекцію `comments` всередині цього документа: `notes/note_id_1/comments/comment_id_A`.
    - **Важливо:** Документи в субколекціях **не завантажуються автоматично** разом з батьківським документом. Щоб отримати їх, потрібно явно зробити окремий запит до субколекції.

#### 2. Запити (Queries)

Ти будеш отримувати дані з Firestore за допомогою запитів.

- **Запити завжди виконуються до колекцій.** Ти не можеш зробити запит, який одразу охоплює кілька колекцій.
- Ти можеш **фільтрувати** дані (наприклад, `where('status', '==', 'completed')`), **сортувати** (`orderBy('createdAt')`), **обмежувати** кількість результатів (`limit(10)`).
- **Індекси:** Для складних запитів (наприклад, фільтрація за кількома полями або комбінація фільтрації та сортування) Firestore може вимагати створення **індексів**. Консоль Firebase підкаже тобі, якщо індекс потрібен, і навіть надасть посилання для його створення.

#### 3. Оновлення в Реальному Часі (Realtime Updates)

Це одна з "фішок" Firestore. Ти можеш "підписатися" на зміни в колекції або документі.

- Якщо хтось інший (або ти сам з іншого пристрою) змінить дані в базі, твій додаток отримає ці оновлення **майже миттєво**, без необхідності перезавантажувати сторінку або робити повторні запити.
- Це ідеально для чатів, спільних документів, динамічних дашбордів тощо. AngularFire чудово інтегрує це через RxJS Observables.

#### 4. Правила Безпеки (Security Rules)

Це **КРИТИЧНО ВАЖЛИВО!** За замовчуванням (особливо, якщо ти вибрав "Start in production mode"), твоя база даних є **повністю закритою**. Це означає, що ніхто (навіть твій Angular-додаток) не зможе читати або писати дані, якщо ти не напишеш відповідні правила.

- **Що це:** Набір правил, написаних у спеціальній мові, які визначають, хто може читати/писати які дані.
- **Де це:** У Firebase Console, розділ "Build" -> "Firestore Database" -> вкладка **"Rules"**.
- **Для початку:** Тобі потрібно буде змінити правила, щоб дозволити читання/запис нотаток. Наприклад, щоб дозволити читання всім:
    
    Фрагмент коду
    
    ```
    rules_version = '2';
    service cloud.firestore {
      match /databases/{database}/documents {
        match /notes/{noteId} {
          allow read: if true; // Дозволити читати всім
          // allow write: if request.auth != null; // Дозволити писати лише авторизованим (для майбутнього)
        }
      }
    }
    ```
    
- **Увага:** Для тестового проекту без аутентифікації, потрібно буде дозволити запис.

#### 5. Безсерверність (Serverless)

- Тобі **не потрібно керувати серверами**. Firebase сам дбає про інфраструктуру, масштабування та підтримку бази даних.
- Ти платиш лише за використання (кількість операцій читання/запису, зберігання). Для твого невеликого проекту це буде безкоштовно в межах тарифу Spark (безкоштовний рівень).
