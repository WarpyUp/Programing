
[[Функціональний API|Функціональний методом]]
### Впровадження Firestore

Щоб сервіс міг взаємодіяти з базою даних [[Firestore]], йому потрібен доступ до екземпляра **`Firestore`**. Angular має механізм для цього, який називається [[Dependency Injection]] (DI) – впровадження залежностей.

Коли ми налаштовували `app.module.ts`, ми вказали Angular, як ініціалізувати Firestore (`provideFirestore(() => getFirestore())`). Тепер нам потрібно, щоб наш сервіс "запитав" цей ініціалізований екземпляр.

Щоб це зробити потрібно додати firestore до конструктора в сервісі.
```ts
constructor(private firestore: Firestore) {  }
```

Все шо далів можна обгорнути в методи.
### Отримання посилання на колекцію Firestore

Тепер, за допомогою екземпляра `Firestore` через `this.firestore`, отримаємо посилання на конкретну колекцію у твоїй базі даних.

Для цього використаємо функцію **`collection`** з `@angular/fire/firestore`. Її потрібно імпортувати.
```ts
const notesCollection = collection(this.firestore, 'notes');
```

- Перший аргумент (`this.firestore`) – це екземпляр бази даних Firestore, який ми впровадили в конструкторі.
- Другий аргумент (`'notes'`) – це назва твоєї колекції у Firebase Firestore. 

Ця функція повертає посилання на колекцію (`CollectionReference`). Це не самі дані, а вказівник на місце, де ці дані знаходяться у базі.

### Перетворюємо посилання на колекцію в Observable

Щоб отримати дані з колекції Firestore як [[Observable]], ми будемо використовувати функцію **`collectionData`** з `@angular/fire/firestore`. Ця функція робить дві дуже корисні речі:

1. Вона "слухає" колекцію в режимі реального часу. Якщо хтось додасть, змінить або видалить нотатку в Firebase, твій додаток отримає оновлення автоматично.
2. Вона перетворює дані Firestore (які мають специфічний формат) на звичайні JavaScript-об'єкти, які відповідають твоєму інтерфейсу `Note[]`.

```ts
collectionData(notesCollection, { idField: 'id' }) as Observable<Note[]>;
```

За замовчуванням, Firebase Firestore зберігає ID кожного документа окремо від його полів.

```ts
{ idField: 'id' } 
```

Ця опція вказує `collectionData` взяти ID кожного документа з Firestore і додати його як нове поле з назвою `id` до об'єкта нотатки.

`as Observable<Note[]>`: Ми використовуємо твердження типу ([[Type Assertions|type assertion]]), щоб сказати TypeScript, що результат цієї функції буде `Observable`, який емітує масив об'єктів типу `Note`.

### Отримати тільки одну нотатку за ID

Треба використати 2 функції:
- **`doc`**: Це функція з AngularFire, яка дозволяє отримати посилання на конкретний документ у Firestore.
- **`docData`**: Це функція, яка перетворює посилання на документ на Observable, що емітує дані цього документа (або `undefined`, якщо документа не існує).

```ts
// doc(firestore, 'колекція/ID_документа')
const noteRef = doc(this.firestore, `notes/${id}`);
```

```ts
docData(noteRef, { idField: 'id' }) as Observable<Note | undefined>;
```

`{ts}{ idField: 'id' }`: Знову ж таки,  гарантує, що ID документа буде додане до обєкта.